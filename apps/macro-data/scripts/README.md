# Macro Data Scripts

–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

---

## üì• Import Historical Data

–°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ø –º–æ–Ω–µ—Ç –∏–∑ CoinGecko API.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –ò–º–ø–æ—Ä—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
cd apps/macro-data
bun run scripts/import-historical-data.ts

# –ò–º–ø–æ—Ä—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
bun run scripts/import-historical-data.ts 7

# –ò–º–ø–æ—Ä—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π
bun run scripts/import-historical-data.ts 90
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

1. **–ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ** –∏–∑ CoinGecko API –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
2. **–ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä—É–µ—Ç** –º–æ–Ω–µ—Ç—ã (DeFi, Layer 1, Layer 2, Meme)
3. **–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç** –≤ ClickHouse —Ç–∞–±–ª–∏—Ü—É `aladdin.top_coins`
4. **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

- `days` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30)

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API

#### CoinGecko Free Tier

- ‚ö†Ô∏è **10-50 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É**
- –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É **12 —Å–µ–∫—É–Ω–¥** –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- **5 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É** - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ª–∏–º–∏—Ç

#### CoinGecko Pro

- ‚úÖ –î–æ **500 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É**
- –ú–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –¥–æ 200-500–º—Å
- –î–æ–±–∞–≤—å—Ç–µ `COINGECKO_API_KEY` –≤ `.env`

### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –î–Ω–µ–π | –ó–∞–ø—Ä–æ—Å–æ–≤ | –í—Ä–µ–º—è (free tier) |
| ---- | -------- | ----------------- |
| 7    | 7        | ~1.5 –º–∏–Ω—É—Ç—ã       |
| 30   | 30       | ~6 –º–∏–Ω—É—Ç          |
| 90   | 90       | ~18 –º–∏–Ω—É—Ç         |

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **ClickHouse** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω
2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –≤ `.env`:

   ```env
   CLICKHOUSE_URL=http://localhost:8123
   CLICKHOUSE_USERNAME=default
   CLICKHOUSE_PASSWORD=your_password
   CLICKHOUSE_DATABASE=aladdin

   # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è Pro tier
   COINGECKO_API_KEY=your_api_key
   ```

3. **–¢–∞–±–ª–∏—Ü–∞** `aladdin.top_coins` –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
üöÄ –ò–º–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ CoinGecko
üìÖ –î–Ω–µ–π –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞: 30
ü™ô –ú–æ–Ω–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å: 100
‚è±Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏: 12—Å

‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ClickHouse —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

üì• [1/30] –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ 2025-09-04...
‚úÖ –£—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ 100 –º–æ–Ω–µ—Ç –∑–∞ 2025-09-04
   –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: { 'Layer 1': 12, 'DeFi': 8, 'Layer 2': 6, 'Meme': 4 }

‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ 12—Å...

...

==================================================
üìä –ò—Ç–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∞:
‚úÖ –£—Å–ø–µ—à–Ω–æ: 30 –¥–Ω–µ–π
‚ùå –û—à–∏–±–æ–∫: 0
==================================================

üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse...

üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
   –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: 3000
   –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–Ω–µ–π: 30
   –ö–∞—Ç–µ–≥–æ—Ä–∏–π: 4
   –ü–µ—Ä–∏–æ–¥: 2025-09-04 ‚Üí 2025-10-04

üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:
   Layer 1: 360 –∑–∞–ø–∏—Å–µ–π
   DeFi: 240 –∑–∞–ø–∏—Å–µ–π
   Layer 2: 180 –∑–∞–ø–∏—Å–µ–π
   Meme: 120 –∑–∞–ø–∏—Å–µ–π

‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!

üí° –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
   1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ frontend –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
   2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Correlation Matrix - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
   3. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–æ –∏—Å—á–µ–∑–Ω—É—Ç—å
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö:

- ‚ùå –û—à–∏–±–∫–∞ API ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –¥–µ–Ω—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç
- ‚ùå –û—à–∏–±–∫–∞ ClickHouse ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –º–æ–Ω–µ—Ç—É –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç
- ‚úÖ –í –∫–æ–Ω—Ü–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —É—Å–ø–µ—Ö–æ–≤/–æ—à–∏–±–æ–∫

### –°–æ–≤–µ—Ç—ã

1. **–ó–∞–ø—É—Å–∫–∞–π—Ç–µ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è** - –¥–æ–ª–≥–∏–π –ø—Ä–æ—Ü–µ—Å—Å
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã API** - –Ω–µ –ø—Ä–µ–≤—ã—à–∞–π—Ç–µ rate limit
3. **–°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏** - –æ–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å
4. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑–æ–ø–∞—Å–µ–Ω** - –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—è—Ç—Å—è

---

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `scripts/your-script.ts`
2. –î–æ–±–∞–≤—å—Ç–µ shebang: `#!/usr/bin/env bun`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –∏–∑ `@aladdin/shared`
4. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ —ç—Ç–æ–º README

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ ClickHouse
clickhouse-client --query "SELECT count(*) FROM aladdin.top_coins"

# –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
clickhouse-client --query "TRUNCATE TABLE aladdin.top_coins"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
clickhouse-client --query "
  SELECT category, count(*)
  FROM aladdin.top_coins
  WHERE category IS NOT NULL
  GROUP BY category
"
```
