# üìä Portfolio Optimization

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è –ø–æ –º–µ—Ç–æ–¥—É Mean-Variance Optimization (Markowitz).

## üéØ –ß—Ç–æ —ç—Ç–æ

**Portfolio Optimization** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≤–µ—Å–æ–≤ –∞–∫—Ç–∏–≤–æ–≤ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ –¥–ª—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∑–∞–¥–∞–Ω–Ω–æ–º —É—Ä–æ–≤–Ω–µ —Ä–∏—Å–∫–∞.

–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ **Modern Portfolio Theory (MPT)** –ì–∞—Ä—Ä–∏ –ú–∞—Ä–∫–æ–≤–∏—Ü–∞ (Nobel Prize 1990).

## üìê –ú–µ—Ç–æ–¥—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. Maximum Sharpe Ratio (default)

**–¶–µ–ª—å:** –ú–∞–∫—Å–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å/—Ä–∏—Å–∫

**–§–æ—Ä–º—É–ª–∞ Sharpe Ratio:**

```
Sharpe = (Return - RiskFreeRate) / Risk
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

- –î–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∏–±–æ–ª–µ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è
- –ö–æ–≥–¥–∞ –Ω–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∏–ª–∏ —Ä–∏—Å–∫—É

### 2. Target Return Optimization

**–¶–µ–ª—å:** –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∏—Å–∫ –ø—Ä–∏ –∑–∞–¥–∞–Ω–Ω–æ–π —Ü–µ–ª–µ–≤–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

- –ï—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ü–µ–ª—å –ø–æ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
- –•–æ—Ç–∏—Ç–µ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∏—Å–∫ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —ç—Ç–æ–π —Ü–µ–ª–∏

### 3. Max Risk Optimization

**–¶–µ–ª—å:** –ú–∞–∫—Å–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –ø—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–∏ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

- –ï—Å—Ç—å –ª–∏–º–∏—Ç –Ω–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ä–∏—Å–∫
- –•–æ—Ç–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –≤ —Ä–∞–º–∫–∞—Ö risk tolerance

## üîß API Endpoint

### POST /api/portfolio/:id/optimize

–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –≤–µ—Å–∞ –∞–∫—Ç–∏–≤–æ–≤ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ.

**Request Body:**

```json
{
  "assets": ["BTCUSDT", "ETHUSDT", "SOLUSDT"],
  "days": 90,
  "constraints": {
    "minWeight": 0.05,
    "maxWeight": 0.5,
    "targetReturn": 0.15,
    "maxRisk": 0.2,
    "allowShorts": false
  }
}
```

**Parameters:**

- `assets` (required): –º–∞—Å—Å–∏–≤ —Å–∏–º–≤–æ–ª–æ–≤ –∞–∫—Ç–∏–≤–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- `days` (optional): –ø–µ—Ä–∏–æ–¥ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (default: 30)
- `constraints` (optional): –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
  - `minWeight`: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å –∞–∫—Ç–∏–≤–∞ (default: 0.0)
  - `maxWeight`: –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å –∞–∫—Ç–∏–≤–∞ (default: 1.0)
  - `targetReturn`: —Ü–µ–ª–µ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (–≥–æ–¥–æ–≤–∞—è)
  - `maxRisk`: –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫/–≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (–≥–æ–¥–æ–≤–∞—è)
  - `allowShorts`: —Ä–∞–∑—Ä–µ—à–∏—Ç—å —à–æ—Ä—Ç—ã (default: false)

**Response:**

```json
{
  "success": true,
  "data": {
    "weights": {
      "BTCUSDT": 0.45,
      "ETHUSDT": 0.35,
      "SOLUSDT": 0.2
    },
    "expectedReturn": 0.156,
    "expectedRisk": 0.185,
    "sharpeRatio": 0.735,
    "efficientFrontier": [
      {
        "risk": 0.15,
        "return": 0.12,
        "sharpe": 0.667
      },
      {
        "risk": 0.18,
        "return": 0.15,
        "sharpe": 0.722
      }
    ]
  },
  "timestamp": 1696435200000
}
```

## üìä Efficient Frontier

**Efficient Frontier** ‚Äî –Ω–∞–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏—Ö –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è —Ä–∏—Å–∫–∞.

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**

```
Return ^
       |     ‚≠ê Optimal (Max Sharpe)
       |    /
       |   /
       |  /  Efficient Frontier
       | /
       |/____________> Risk
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**

- –¢–æ—á–∫–∏ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä—Ç—Ñ–µ–ª–∏
- –¢–æ—á–∫–∞ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º Sharpe Ratio ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å
- –¢–æ—á–∫–∏ –Ω–∏–∂–µ –≥—Ä–∞–Ω–∏—Ü—ã ‚Äî –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ

## üí° –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ë–∞–∑–æ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (Max Sharpe)

```bash
curl -X POST "http://localhost:3012/api/portfolio/my-portfolio/optimize" \
  -H "Content-Type: application/json" \
  -H "x-user-id: user123" \
  -d '{
    "assets": ["BTCUSDT", "ETHUSDT", "BNBUSDT"],
    "days": 90
  }'
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å —Ü–µ–ª–µ–≤–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å—é

```bash
curl -X POST "http://localhost:3012/api/portfolio/my-portfolio/optimize" \
  -H "Content-Type: application/json" \
  -H "x-user-id: user123" \
  -d '{
    "assets": ["BTCUSDT", "ETHUSDT", "SOLUSDT"],
    "days": 60,
    "constraints": {
      "targetReturn": 0.20
    }
  }'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ—Ä—Ç—Ñ–µ–ª—å —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ä–∏—Å–∫–æ–º –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è 20% –≥–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏.

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —Ä–∏—Å–∫–∞

```bash
curl -X POST "http://localhost:3012/api/portfolio/my-portfolio/optimize" \
  -H "Content-Type: application/json" \
  -H "x-user-id: user123" \
  -d '{
    "assets": ["BTCUSDT", "ETHUSDT", "ADAUSDT"],
    "days": 30,
    "constraints": {
      "maxRisk": 0.15
    }
  }'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ—Ä—Ç—Ñ–µ–ª—å —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å—é –ø—Ä–∏ —Ä–∏—Å–∫–µ –Ω–µ –≤—ã—à–µ 15%.

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –≤–µ—Å–æ–≤

```bash
curl -X POST "http://localhost:3012/api/portfolio/my-portfolio/optimize" \
  -H "Content-Type: application/json" \
  -H "x-user-id: user123" \
  -d '{
    "assets": ["BTCUSDT", "ETHUSDT", "SOLUSDT", "BNBUSDT"],
    "days": 90,
    "constraints": {
      "minWeight": 0.10,
      "maxWeight": 0.40
    }
  }'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–∞–∂–¥—ã–π –∞–∫—Ç–∏–≤ –±—É–¥–µ—Ç –∏–º–µ—Ç—å –≤–µ—Å –æ—Ç 10% –¥–æ 40%.

## üßÆ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Gradient Descent** –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≤–µ—Å–æ–≤:

1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: —Ä–∞–≤–Ω—ã–µ –≤–µ—Å–∞ –¥–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–æ–≤
2. –†–∞—Å—á–µ—Ç —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (Sharpe Ratio, —Ä–∏—Å–∫, –∏–ª–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å)
3. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Å–æ–≤ –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞
5. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤ (—Å—É–º–º–∞ = 1)
6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
7. –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —à–∞–≥–æ–≤ 2-6 –¥–æ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –†–∞—Å—á–µ—Ç –∫–æ–≤–∞—Ä–∏–∞—Ü–∏–æ–Ω–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã

```typescript
Cov(i, j) = E[(Ri - E[Ri]) * (Rj - E[Rj])]
```

–ì–¥–µ:

- `Ri`, `Rj` ‚Äî –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–æ–≤ i –∏ j
- `E[.]` ‚Äî –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ

### –†–∞—Å—á–µ—Ç —Ä–∏—Å–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è

```typescript
Risk = sqrt(w ^ (T * Œ£ * w))
```

–ì–¥–µ:

- `w` ‚Äî –≤–µ–∫—Ç–æ—Ä –≤–µ—Å–æ–≤
- `Œ£` ‚Äî –∫–æ–≤–∞—Ä–∏–∞—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞
- `^T` ‚Äî —Ç—Ä–∞–Ω—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–∞—Å—á–µ—Ç –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è

```typescript
Return = sum(wi * Ri)
```

–ì–¥–µ:

- `wi` ‚Äî –≤–µ—Å –∞–∫—Ç–∏–≤–∞ i
- `Ri` ‚Äî –æ–∂–∏–¥–∞–µ–º–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∞ i

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

1. **Gradient Descent –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ–±–ª—é–¥–µ–Ω–∏—è constraints**

   - Constraints –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è post-hoc —á–µ—Ä–µ–∑ normalization
   - –î–ª—è —Å—Ç—Ä–æ–≥–∏—Ö constraints –Ω—É–∂–µ–Ω Quadratic Programming

2. **–õ–∏–Ω–µ–π–Ω–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è**

   - –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –ª–∏–Ω–µ–π–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É –∞–∫—Ç–∏–≤–∞–º–∏
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–µ–ª–∏–Ω–µ–π–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã

3. **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ**

   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—è—Ö
   - –ü—Ä–æ—à–ª—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç –±—É–¥—É—â–∏—Ö

4. **–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**
   - –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π
   - –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å fat-tailed

## üöÄ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### Planned:

1. **Black-Litterman Model** ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
2. **Robust Optimization** ‚Äî —É—á–µ—Ç –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
3. **Multi-period Optimization** ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–∏–æ–¥–æ–≤
4. **Transaction Costs** ‚Äî —É—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π –ø—Ä–∏ rebalancing
5. **Hierarchical Risk Parity** ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω–≤–µ—Ä—Å–∏–∏ –∫–æ–≤–∞—Ä–∏–∞—Ü–∏–æ–Ω–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã)
6. **Convex Optimization (CVXPY)** ‚Äî —Ç–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å constraints
7. **Regime Switching** ‚Äî –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –∏–∑–º–µ–Ω—è—é—â–∏–º—Å—è —Ä—ã–Ω–æ—á–Ω—ã–º —Ä–µ–∂–∏–º–∞–º

## üìö –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞

1. **Markowitz, H. (1952)** - "Portfolio Selection" - Journal of Finance
2. **Sharpe, W. (1994)** - "The Sharpe Ratio" - Journal of Portfolio Management
3. **Black & Litterman (1992)** - "Global Portfolio Optimization"
4. **DeMiguel et al. (2009)** - "Optimal Versus Naive Diversification"

## üîó –°–º. —Ç–∞–∫–∂–µ

- [Portfolio Service](../README.md)
- [Risk Management](../../risk/ADVANCED_RISK_METRICS.md)
- [Aladdin Roadmap](../../../docs/ALADDIN_ROADMAP.md)
