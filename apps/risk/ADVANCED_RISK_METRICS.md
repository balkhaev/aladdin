# Advanced Risk Metrics API

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–º –º–µ—Ç—Ä–∏–∫–∞–º —Ä–∏—Å–∫–∞, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º –≤ Risk Service.

## üéØ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. CVaR (Conditional Value at Risk / Expected Shortfall)

**–ß—Ç–æ —ç—Ç–æ:** –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫ –≤ —Ö—É–¥—à–∏—Ö —Å–ª—É—á–∞—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ö—É–¥—à–∏–µ 5% —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤).

**–ó–∞—á–µ–º:** –ë–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ tail risk, —á–µ–º VaR. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ –ø–ª–æ—Ö–æ –º–æ–∂–µ—Ç –±—ã—Ç—å, –µ—Å–ª–∏ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Ö—É–¥—à–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞–¥ VaR:**

- Coherent risk measure (–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–æ–ª–µ–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞)
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –í–°–ï —Ö–≤–æ—Å—Ç–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ threshold
- –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç—Å—è Basel III –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏

### 2. Stress Testing

**–ß—Ç–æ —ç—Ç–æ:** –°–∏–º—É–ª—è—Ü–∏—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

**–ó–∞—á–µ–º:** –ü–æ–Ω—è—Ç—å, –∫–∞–∫ –ø–æ—Ä—Ç—Ñ–µ–ª—å –ø–æ–≤–µ–¥–µ—Ç —Å–µ–±—è –≤ –∫—Ä–∏–∑–∏—Å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö.

**–°—Ü–µ–Ω–∞—Ä–∏–∏:**

- COVID-19 Crash (Mar 2020) - BTC -50%, ETH -60%
- Crypto Winter 2022 - Luna/FTX collapse
- Flash Crash - –í–Ω–µ–∑–∞–ø–Ω—ã–π –æ–±–≤–∞–ª –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
- Exchange Hack - –í–∑–ª–æ–º –±–∏—Ä–∂–∏
- Regulatory Crackdown - –ó–∞–ø—Ä–µ—Ç –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
- Black Swan - –ù–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞
- Bull Market Peak - –ü–µ—Ä–µ–≥—Ä–µ–≤ —Ä—ã–Ω–∫–∞
- Stablecoin De-peg - –ü–æ—Ç–µ—Ä—è –ø–µ–≥–∞ —Å—Ç–µ–π–±–ª–∫–æ–∏–Ω–æ–º

### 3. Beta (Market Sensitivity)

**–ß—Ç–æ —ç—Ç–æ:** –ú–µ—Ä–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è –∫ —Ä—ã–Ω–∫—É (BTC).

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**

- **Beta = 1.0** - –ø–æ—Ä—Ç—Ñ–µ–ª—å –¥–≤–∏–∂–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —Ä—ã–Ω–∫–æ–º
- **Beta > 1.0** - –ø–æ—Ä—Ç—Ñ–µ–ª—å –±–æ–ª–µ–µ –≤–æ–ª–∞—Ç–∏–ª–µ–Ω (—É—Å–∏–ª–∏–≤–∞–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è)
- **Beta < 1.0** - –ø–æ—Ä—Ç—Ñ–µ–ª—å –º–µ–Ω–µ–µ –≤–æ–ª–∞—Ç–∏–ª–µ–Ω (–¥–µ–º–ø—Ñ–∏—Ä—É–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è)
- **Beta = 0.0** - –Ω–µ –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç —Å —Ä—ã–Ω–∫–æ–º
- **Beta < 0.0** - –¥–≤–∏–∂–µ—Ç—Å—è –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ —Ä—ã–Ω–∫—É

**–ó–∞—á–µ–º:**

- –ü–æ–Ω—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç BTC (–æ—Å–Ω–æ–≤–Ω–æ–π —Ä—ã–Ω–æ—á–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä)
- –û—Ü–µ–Ω–∏—Ç—å systematic risk (—Ä—ã–Ω–æ—á–Ω—ã–π) vs idiosyncratic risk (–ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–π)
- –°–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ —Ä—ã–Ω–∫–∞

---

## üì° API Endpoints

### 1. Calculate CVaR

**Endpoint:** `GET /api/risk/cvar/:portfolioId`

**Query Parameters:**

- `confidence` (optional): 95 –∏–ª–∏ 99 (default: 95)

**Example Request:**

```bash
curl -X GET "http://localhost:3013/api/risk/cvar/portfolio123?confidence=95"
```

**Example Response:**

```json
{
  "success": true,
  "data": {
    "cvar95": 8500.50,
    "cvar99": 12300.75,
    "var95": 6200.00,
    "var99": 9800.00,
    "portfolioValue": 100000,
    "tailRisk95": 1.37,
    "tailRisk99": 1.26,
    "historicalReturns": [-0.05, -0.03, ...],
    "calculatedAt": "2025-10-04T10:30:00Z"
  },
  "timestamp": 1728036600000
}
```

**Response Fields:**

- `cvar95` - CVaR –Ω–∞ —É—Ä–æ–≤–Ω–µ 95% (–≤ –¥–æ–ª–ª–∞—Ä–∞—Ö)
- `cvar99` - CVaR –Ω–∞ —É—Ä–æ–≤–Ω–µ 99% (–≤ –¥–æ–ª–ª–∞—Ä–∞—Ö)
- `var95` - VaR –Ω–∞ —É—Ä–æ–≤–Ω–µ 95% –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- `var99` - VaR –Ω–∞ —É—Ä–æ–≤–Ω–µ 99% –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- `tailRisk95` - Tail Risk Ratio (CVaR/VaR). –ï—Å–ª–∏ > 1.5, —Ç–æ tail risk –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π
- `tailRisk99` - Tail Risk Ratio –¥–ª—è 99%
- `portfolioValue` - –¢–µ–∫—É—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è
- `historicalReturns` - –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
- `calculatedAt` - –í—Ä–µ–º—è —Ä–∞—Å—á–µ—Ç–∞

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**

- **CVaR 95% = $8,500** –æ–∑–Ω–∞—á–∞–µ—Ç: –≤ —Ö—É–¥—à–∏—Ö 5% —Å–ª—É—á–∞–µ–≤ —Å—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫ —Å–æ—Å—Ç–∞–≤–∏—Ç $8,500
- **Tail Risk 95% = 1.37** –æ–∑–Ω–∞—á–∞–µ—Ç: —Ö—É–¥—à–∏–µ –ø–æ—Ç–µ—Ä–∏ –Ω–∞ 37% –±–æ–ª—å—à–µ, —á–µ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç VaR

---

### 2. Run Stress Test

**Endpoint:** `POST /api/risk/stress-test/:portfolioId`

**Request Body (optional):**

```json
{
  "scenarios": [
    {
      "name": "Custom Crash",
      "description": "My custom scenario",
      "priceShocks": {
        "BTCUSDT": -40,
        "ETHUSDT": -50,
        "default": -60
      },
      "volumeShock": 200,
      "spreadShock": 5,
      "liquidityShock": -80
    }
  ]
}
```

**Example Request (default scenarios):**

```bash
curl -X POST "http://localhost:3013/api/risk/stress-test/portfolio123" \
  -H "Content-Type: application/json" \
  -d '{}'
```

**Example Response:**

```json
{
  "success": true,
  "data": {
    "scenarios": [
      {
        "scenario": "COVID-19 Crash (Mar 2020)",
        "description": "Black Thursday - Bitcoin dropped 50% in 24 hours",
        "currentValue": 100000,
        "stressedValue": 45000,
        "loss": 55000,
        "lossPercentage": 55,
        "positionImpacts": [
          {
            "symbol": "BTCUSDT",
            "currentValue": 50000,
            "stressedValue": 25000,
            "loss": 25000,
            "lossPercentage": 50
          }
        ],
        "liquidationRisk": false,
        "marginCallRisk": true,
        "recoveryTimeEstimate": 180,
        "timestamp": "2025-10-04T10:30:00Z"
      }
    ],
    "worstCase": {
      "scenario": "Black Swan Event",
      "loss": 75000,
      "lossPercentage": 75
    },
    "bestCase": {
      "scenario": "Flash Crash",
      "loss": 30000,
      "lossPercentage": 30
    },
    "averageLoss": 52500,
    "averageLossPercentage": 52.5,
    "resilienceScore": 47.5,
    "recommendations": [
      "‚ö†Ô∏è –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: —Å—Ä–µ–¥–Ω—è—è –ø–æ—Ç–µ—Ä—è 52.5%. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É–ª—É—á—à–∏—Ç—å –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—é.",
      "üíÄ –í –Ω–∞–∏—Ö—É–¥—à–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏ \"Black Swan Event\" –ø–æ—Ç–µ—Ä–∏ —Å–æ—Å—Ç–∞–≤—è—Ç 75.0%. –•–µ–¥–∂–∏—Ä—É–π—Ç–µ —Ä–∏—Å–∫–∏ –æ–ø—Ü–∏–æ–Ω–∞–º–∏ –∏–ª–∏ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞–º–∏."
    ]
  },
  "timestamp": 1728036600000
}
```

**Response Fields:**

- `scenarios` - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- `worstCase` - –ù–∞–∏—Ö—É–¥—à–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π
- `bestCase` - –ù–∞–∏–ª—É—á—à–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–Ω–∞–∏–º–µ–Ω—å—à–∏–µ –ø–æ—Ç–µ—Ä–∏)
- `averageLoss` - –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫ –ø–æ –≤—Å–µ–º —Å—Ü–µ–Ω–∞—Ä–∏—è–º
- `averageLossPercentage` - –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
- `resilienceScore` - –û—Ü–µ–Ω–∫–∞ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ (0-100, –≤—ã—à–µ = –ª—É—á—à–µ)
- `recommendations` - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è Resilience Score:**

- **80-100**: –û—Ç–ª–∏—á–Ω–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –ø–æ—Ä—Ç—Ñ–µ–ª—å —Ö–æ—Ä–æ—à–æ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
- **60-80**: –•–æ—Ä–æ—à–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, —É–º–µ—Ä–µ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏
- **40-60**: –°—Ä–µ–¥–Ω—è—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—é
- **20-40**: –ù–∏–∑–∫–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –≤—ã—Å–æ–∫–∏–µ —Ä–∏—Å–∫–∏
- **0-20**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã —Å—Ä–æ—á–Ω—ã–µ –º–µ—Ä—ã

---

### 3. Get Stress Test Scenarios

**Endpoint:** `GET /api/risk/stress-test/scenarios`

**Example Request:**

```bash
curl -X GET "http://localhost:3013/api/risk/stress-test/scenarios"
```

**Example Response:**

```json
{
  "success": true,
  "data": [
    {
      "name": "COVID-19 Crash (Mar 2020)",
      "description": "Black Thursday - Bitcoin dropped 50% in 24 hours",
      "priceShocks": {
        "BTCUSDT": -50,
        "ETHUSDT": -60,
        "default": -70
      },
      "volumeShock": 300,
      "spreadShock": 5,
      "liquidityShock": -40
    }
  ],
  "timestamp": 1728036600000
}
```

---

### 4. Calculate Portfolio Beta

**Endpoint:** `GET /api/risk/beta/:portfolioId`

**Query Parameters:**

- `days` (optional): –ø–µ—Ä–∏–æ–¥ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ (default: 30)
- `market` (optional): —Ä—ã–Ω–æ—á–Ω—ã–π —Å–∏–º–≤–æ–ª (default: "BTCUSDT")

**Example Request:**

```bash
curl "http://localhost:3013/api/risk/beta/portfolio123?days=30&market=BTCUSDT"
```

**Example Response:**

```json
{
  "success": true,
  "data": {
    "beta": 1.25,
    "alpha": 0.0012,
    "rSquared": 0.85,
    "correlation": 0.92,
    "portfolioReturns": [-0.02, 0.03, ...],
    "marketReturns": [-0.015, 0.025, ...],
    "period": {
      "from": "2025-09-04T00:00:00Z",
      "to": "2025-10-04T00:00:00Z"
    },
    "calculatedAt": "2025-10-04T12:00:00Z"
  }
}
```

**Response Fields:**

- `beta` - Beta coefficient (—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ —Ä—ã–Ω–∫—É)
- `alpha` - Jensen's alpha (excess return vs market)
- `rSquared` - R¬≤ (–∫–∞–∫–∞—è —á–∞—Å—Ç—å –¥–∏—Å–ø–µ—Ä—Å–∏–∏ –æ–±—ä—è—Å–Ω—è–µ—Ç—Å—è —Ä—ã–Ω–∫–æ–º, 0-1)
- `correlation` - –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å —Ä—ã–Ω–∫–æ–º (-1 to 1)

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**

- **Beta = 1.25** –æ–∑–Ω–∞—á–∞–µ—Ç: –ø—Ä–∏ —Ä–æ—Å—Ç–µ BTC –Ω–∞ 10%, –ø–æ—Ä—Ç—Ñ–µ–ª—å –≤—ã—Ä–∞—Å—Ç–µ—Ç –Ω–∞ 12.5%
- **R¬≤ = 0.85** –æ–∑–Ω–∞—á–∞–µ—Ç: 85% –¥–≤–∏–∂–µ–Ω–∏–π –ø–æ—Ä—Ç—Ñ–µ–ª—è –æ–±—ä—è—Å–Ω—è—é—Ç—Å—è –¥–≤–∏–∂–µ–Ω–∏—è–º–∏ BTC
- **Alpha > 0** –æ–∑–Ω–∞—á–∞–µ—Ç: –ø–æ—Ä—Ç—Ñ–µ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç excess return —Å–≤–µ—Ä—Ö —Ä—ã–Ω–∫–∞

---

### 5. Multi-Market Beta

**Endpoint:** `GET /api/risk/beta/:portfolioId/multi-market`

**Query Parameters:**

- `days` (optional): –ø–µ—Ä–∏–æ–¥ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ (default: 30)

**Example Request:**

```bash
curl "http://localhost:3013/api/risk/beta/portfolio123/multi-market?days=30"
```

**Example Response:**

```json
{
  "success": true,
  "data": {
    "btcBeta": {
      "beta": 1.25,
      "alpha": 0.0012,
      "rSquared": 0.85
    },
    "ethBeta": {
      "beta": 1.45,
      "alpha": 0.0015,
      "rSquared": 0.78
    },
    "marketRegime": "BULL",
    "systematicRisk": 8.5,
    "idiosyncraticRisk": 1.5
  }
}
```

**Response Fields:**

- `btcBeta` - Beta –∫ BTC (–æ—Å–Ω–æ–≤–Ω–æ–π —Ä—ã–Ω–æ—á–Ω—ã–π –ø—Ä–æ–∫—Å–∏)
- `ethBeta` - Beta –∫ ETH (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–∫—Å–∏)
- `marketRegime` - –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (BULL/BEAR/SIDEWAYS)
- `systematicRisk` - –†—ã–Ω–æ—á–Ω—ã–π —Ä–∏—Å–∫ (–Ω–µ –º–æ–∂–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å)
- `idiosyncraticRisk` - –ü–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–π —Ä–∏—Å–∫ (–º–æ–∂–µ–º –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å)

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è Systematic vs Idiosyncratic Risk:**

- **Systematic Risk –≤—ã—Å–æ–∫–∏–π** - –ø–æ—Ä—Ç—Ñ–µ–ª—å —Å–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä—ã–Ω–∫–∞
- **Idiosyncratic Risk –≤—ã—Å–æ–∫–∏–π** - –º–Ω–æ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∏—Å–∫–∞, –Ω—É–∂–Ω–∞ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

---

### 6. Rolling Beta

**Endpoint:** `GET /api/risk/beta/:portfolioId/rolling`

**Query Parameters:**

- `totalDays` (optional): –æ–±—â–∏–π –ø–µ—Ä–∏–æ–¥ (default: 90)
- `windowDays` (optional): –æ–∫–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ (default: 30)
- `market` (optional): —Ä—ã–Ω–æ—á–Ω—ã–π —Å–∏–º–≤–æ–ª (default: "BTCUSDT")

**Example Request:**

```bash
curl "http://localhost:3013/api/risk/beta/portfolio123/rolling?totalDays=90&windowDays=30"
```

**Example Response:**

```json
{
  "success": true,
  "data": [
    {
      "date": "2025-07-04T00:00:00Z",
      "beta": 1.15,
      "rSquared": 0.82
    },
    {
      "date": "2025-08-04T00:00:00Z",
      "beta": 1.22,
      "rSquared": 0.84
    },
    {
      "date": "2025-09-04T00:00:00Z",
      "beta": 1.25,
      "rSquared": 0.85
    }
  ]
}
```

**–ó–∞—á–µ–º Rolling Beta:**

- –í–∏–¥–µ—Ç—å, –∫–∞–∫ beta –º–µ–Ω—è–µ—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
- –û–±–Ω–∞—Ä—É–∂–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä—ã–Ω–æ—á–Ω–æ–π —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü–æ–Ω—è—Ç—å, —Å—Ç–∞–±–∏–ª—å–Ω–∞ –ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

---

## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Å–∫–æ–≤

```typescript
// –£—Ç—Ä–µ–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è
async function dailyRiskCheck(portfolioId: string) {
  // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º VaR –∏ CVaR
  const cvar = await fetch(
    `http://localhost:3013/api/risk/cvar/${portfolioId}?confidence=95`
  ).then((r) => r.json())

  console.log(`–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–∂–∏–¥–∞–µ–º—ã–π —É–±—ã—Ç–æ–∫ (VaR 95%): $${cvar.data.var95}`)
  console.log(
    `–°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫ –≤ —Ö—É–¥—à–∏—Ö —Å–ª—É—á–∞—è—Ö (CVaR 95%): $${cvar.data.cvar95}`
  )
  console.log(`Tail Risk Ratio: ${cvar.data.tailRisk95}x`)

  // 2. –ï—Å–ª–∏ tail risk –≤—ã—Å–æ–∫–∏–π, –∑–∞–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç
  if (cvar.data.tailRisk95 > 1.5) {
    const stressTest = await fetch(
      `http://localhost:3013/api/risk/stress-test/${portfolioId}`,
      { method: "POST" }
    ).then((r) => r.json())

    console.log(`Resilience Score: ${stressTest.data.resilienceScore}/100`)
    console.log("Recommendations:", stressTest.data.recommendations)
  }
}
```

### –ü—Ä–∏–º–µ—Ä 2: Before Opening Large Position

```typescript
// –ü–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –∫—Ä—É–ø–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
async function checkPositionRisk(portfolioId: string) {
  // –ó–∞–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç
  const result = await fetch(
    `http://localhost:3013/api/risk/stress-test/${portfolioId}`,
    { method: "POST" }
  ).then((r) => r.json())

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∏—Å–∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
  const hasLiquidationRisk = result.data.scenarios.some(
    (s: any) => s.liquidationRisk
  )

  if (hasLiquidationRisk) {
    console.warn("‚ö†Ô∏è DANGER: –†–∏—Å–∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö!")
    console.warn("–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Å–Ω–∏–∑–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –∏–ª–∏ –ø–ª–µ—á–æ.")
    return false // –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
  }

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–µ–¥–Ω—é—é –ø–æ—Ç–µ—Ä—é
  if (result.data.averageLossPercentage > 50) {
    console.warn("‚ö†Ô∏è WARNING: –°—Ä–µ–¥–Ω—è—è –ø–æ—Ç–µ—Ä—è > 50%")
    console.warn("–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –¥–æ–±–∞–≤–∏—Ç—å —Ö–µ–¥–∂–∏—Ä–æ–≤–∞–Ω–∏–µ.")
  }

  return true // –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é
}
```

### –ü—Ä–∏–º–µ—Ä 3: Portfolio Rebalancing Decision

```typescript
// –†–µ—à–µ–Ω–∏–µ –æ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è
async function shouldRebalance(portfolioId: string): Promise<boolean> {
  const stressTest = await fetch(
    `http://localhost:3013/api/risk/stress-test/${portfolioId}`,
    { method: "POST" }
  ).then((r) => r.json())

  // –°–º–æ—Ç—Ä–∏–º –Ω–∞ resilience score
  const score = stressTest.data.resilienceScore

  if (score < 40) {
    console.log("üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å. –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞!")
    return true
  }

  if (score < 60) {
    console.log("üü° –°—Ä–µ–¥–Ω—è—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞.")
    return true
  }

  console.log("üü¢ –•–æ—Ä–æ—à–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å. –†–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.")
  return false
}
```

---

## üîç –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### CVaR

**–•–æ—Ä–æ—à–∏–π –ø–æ—Ä—Ç—Ñ–µ–ª—å:**

- CVaR 95% < 5% –æ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—è
- Tail Risk Ratio < 1.3
- CVaR –Ω–µ —Å–ª–∏—à–∫–æ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç VaR

**–ü–ª–æ—Ö–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å:**

- CVaR 95% > 10% –æ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—è
- Tail Risk Ratio > 1.5 (–±–æ–ª—å—à–∏–µ —Ö–≤–æ—Å—Ç–æ–≤—ã–µ —Ä–∏—Å–∫–∏!)
- CVaR –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–µ VaR

### Stress Test

**–•–æ—Ä–æ—à–∏–π –ø–æ—Ä—Ç—Ñ–µ–ª—å:**

- Resilience Score > 60
- –ù–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å liquidation risk
- Average loss < 30%
- Recovery time < 90 –¥–Ω–µ–π

**–ü–ª–æ—Ö–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å:**

- Resilience Score < 40
- –ï—Å—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å liquidation risk
- Average loss > 50%
- Recovery time > 180 –¥–Ω–µ–π

---

## üöÄ Best Practices

1. **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ CVaR** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ tail risk
2. **Stress testing –ø–µ—Ä–µ–¥ –∫—Ä—É–ø–Ω—ã–º–∏ —Å–¥–µ–ª–∫–∞–º–∏** - –∏–∑–±–µ–≥–∞–π—Ç–µ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ—Å—Ç–µ–π
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ resilience score** - –¥–µ—Ä–∂–∏—Ç–µ > 60
4. **–†–µ–∞–≥–∏—Ä—É–π—Ç–µ –Ω–∞ recommendations** - AI –¥–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ custom scenarios** - —Å–∏–º—É–ª–∏—Ä—É–π—Ç–µ —Å–≤–æ–∏ –æ–ø–∞—Å–µ–Ω–∏—è

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏

| –ú–µ—Ç—Ä–∏–∫–∞              | –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç                          | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
| -------------------- | --------------------------------------- | ------------------ |
| **VaR**              | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–±—ã—Ç–æ–∫ –ø—Ä–∏ normal —É—Å–ª–æ–≤–∏—è—Ö | –û–±—ã—á–Ω—ã–π –¥–µ–Ω—å       |
| **CVaR**             | –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫ –≤ —Ö—É–¥—à–∏—Ö —Å–ª—É—á–∞—è—Ö         | –û—Ü–µ–Ω–∫–∞ tail risk   |
| **Max Drawdown**     | –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π drawdown      | –ü—Ä–æ—à–ª—ã–µ —Ä–∏—Å–∫–∏      |
| **Stress Test**      | –ü–æ—Ç–µ—Ä–∏ –≤ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö        | "–ß—Ç–æ –µ—Å–ª–∏?"        |
| **Resilience Score** | –û–±—â–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è             | Quick check        |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–º–µ—Å—Ç–µ –¥–ª—è –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω—ã —Ä–∏—Å–∫–æ–≤!

---

## üéì –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–°–ª–µ–¥—É—é—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤ roadmap:

- [ ] Beta calculation (—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ BTC/—Ä—ã–Ω–∫—É)
- [ ] Liquidity Risk Management
- [ ] Portfolio Optimization (Markowitz)
- [ ] Performance Attribution

–°–º. [ALADDIN_ROADMAP.md](../../docs/ALADDIN_ROADMAP.md) –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ roadmap.
