# üìä Market Impact Modeling

–û—Ü–µ–Ω–∫–∞ –≤–ª–∏—è–Ω–∏—è –∫—Ä—É–ø–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ –Ω–∞ —Ä—ã–Ω–æ–∫ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.

## üéØ –ß—Ç–æ —ç—Ç–æ

**Market Impact** ‚Äî —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –∞–∫—Ç–∏–≤–∞, –≤—ã–∑–≤–∞–Ω–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ–º –∫—Ä—É–ø–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞. –ü–æ–Ω–∏–º–∞–Ω–∏–µ market impact –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è:

- –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–¥–µ—Ä–∂–µ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
- –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –æ—Ä–¥–µ—Ä–æ–≤
- –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
- –û—Ü–µ–Ω–∫–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ —Ä—ã–Ω–∫–∞

## üìê –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Market Impact

### 1. Temporary Impact (–í—Ä–µ–º–µ–Ω–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏–∑-–∑–∞ –¥–∞–≤–ª–µ–Ω–∏—è —Å–ø—Ä–æ—Å–∞/–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

**–§–æ—Ä–º—É–ª–∞:**

```
Temporary Impact = œÉ √ó sqrt(participation_rate) √ó urgency_factor
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**

- –û–±—Ä–∞—Ç–∏–º–æ (—Ü–µ–Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è)
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –æ—Ä–¥–µ—Ä–∞ –∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
- –í—ã—à–µ –¥–ª—è —Å—Ä–æ—á–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤

### 2. Permanent Impact (–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏–∑-–∑–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞

**–§–æ—Ä–º—É–ª–∞:**

```
Permanent Impact = participation_rate √ó œÉ √ó 0.1
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**

- –ù–µ–æ–±—Ä–∞—Ç–∏–º–æ (–æ—Ç—Ä–∞–∂–∞–µ—Ç –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é)
- –û–±—ã—á–Ω–æ ~10% –æ—Ç temporary impact
- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç "—É—Ç–µ—á–∫—É" –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ —Ä—ã–Ω–æ–∫

### 3. Spread Cost (–°—Ç–æ–∏–º–æ—Å—Ç—å —Å–ø—Ä–µ–¥–∞)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ò–∑–¥–µ—Ä–∂–∫–∏ –Ω–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ bid-ask spread

**–§–æ—Ä–º—É–ª–∞:**

```
Spread Cost = (spread / price) √ó 0.5
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**

- –ù–µ–∏–∑–±–µ–∂–Ω—ã–µ –∏–∑–¥–µ—Ä–∂–∫–∏ –¥–ª—è market orders
- –ù–∏–∂–µ –¥–ª—è limit orders
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏

## üîß API Endpoints

### 1. Calculate Market Impact

**Endpoint:** `POST /api/trading/market-impact`

–û—Ü–µ–Ω–∏–≤–∞–µ—Ç –≤–ª–∏—è–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ –Ω–∞ —Ä—ã–Ω–æ–∫.

**Request Body:**

```json
{
  "symbol": "BTCUSDT",
  "orderSize": 100000,
  "side": "BUY",
  "urgency": "medium",
  "currentPrice": 50000,
  "dailyVolume": 1000000,
  "spread": 0.001,
  "volatility": 0.02
}
```

**Parameters:**

- `symbol`: —Ç–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞
- `orderSize`: —Ä–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞ –≤ USD
- `side`: "BUY" | "SELL"
- `urgency` (optional): "low" | "medium" | "high" (default: "medium")
- `currentPrice`: —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞
- `dailyVolume`: –¥–Ω–µ–≤–Ω–æ–π –æ–±—ä–µ–º —Ç–æ—Ä–≥–æ–≤ –≤ USD
- `spread`: bid-ask spread (–≤ –¥–æ–ª—è—Ö, 0.001 = 0.1%)
- `volatility` (optional): –¥–Ω–µ–≤–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (default: 0.02 = 2%)

**Response:**

```json
{
  "success": true,
  "data": {
    "temporaryImpact": 0.0015,
    "permanentImpact": 0.0002,
    "expectedSlippage": 0.0022,
    "estimatedCost": 220,
    "participationRate": 0.1,
    "priceImpactBps": 22,
    "recommendation": {
      "shouldSplit": true,
      "optimalChunks": 4,
      "timeHorizon": 30,
      "reason": "Medium urgency - balanced splitting strategy"
    }
  },
  "timestamp": 1696435200000
}
```

### 2. Generate Order Splitting Strategy

**Endpoint:** `POST /api/trading/order-splitting`

–°–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Ä–∞–∑–±–∏–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞ –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ impact.

**Request Body:**

```json
{
  "impact": {
    "temporaryImpact": 0.0015,
    "permanentImpact": 0.0002,
    "expectedSlippage": 0.0022,
    "estimatedCost": 220,
    "participationRate": 0.1,
    "priceImpactBps": 22,
    "recommendation": {
      "shouldSplit": true,
      "optimalChunks": 4,
      "timeHorizon": 30,
      "reason": "Medium urgency"
    }
  },
  "orderSize": 100000,
  "volatility": 0.02
}
```

**Response:**

```json
{
  "success": true,
  "data": {
    "chunks": [
      {
        "size": 25000,
        "delayMinutes": 0,
        "estimatedSlippage": 0.0008
      },
      {
        "size": 25000,
        "delayMinutes": 7.5,
        "estimatedSlippage": 0.0008
      },
      {
        "size": 25000,
        "delayMinutes": 15,
        "estimatedSlippage": 0.0008
      },
      {
        "size": 25000,
        "delayMinutes": 22.5,
        "estimatedSlippage": 0.0008
      }
    ],
    "totalSlippage": 0.0008,
    "totalTime": 30,
    "savingsVsImmediate": 140
  },
  "timestamp": 1696435200000
}
```

### 3. Calculate Implementation Shortfall

**Endpoint:** `POST /api/trading/implementation-shortfall`

–í—ã—á–∏—Å–ª—è–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —Ä–µ—à–µ–Ω–∏–µ–º –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º.

**Request Body:**

```json
{
  "decisionPrice": 50000,
  "actualFillPrice": 50100,
  "orderSize": 100000,
  "side": "BUY"
}
```

**Response:**

```json
{
  "success": true,
  "data": {
    "shortfall": 0.002,
    "shortfallBps": 20,
    "cost": 200
  },
  "timestamp": 1696435200000
}
```

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –û—Ü–µ–Ω–∫–∞ impact –¥–ª—è –∫—Ä—É–ø–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞

```bash
curl -X POST "http://localhost:3011/api/trading/market-impact" \
  -H "Content-Type: application/json" \
  -d '{
    "symbol": "BTCUSDT",
    "orderSize": 500000,
    "side": "BUY",
    "urgency": "low",
    "currentPrice": 50000,
    "dailyVolume": 1000000,
    "spread": 0.001,
    "volatility": 0.025
  }'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—Ü–µ–Ω–∫–∞ –≤–ª–∏—è–Ω–∏—è –æ—Ä–¥–µ—Ä–∞ –Ω–∞ $500K (50% –æ—Ç –¥–Ω–µ–≤–Ω–æ–≥–æ –æ–±—ä–µ–º–∞) —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–µ–π.

### 2. –†–∞–∑–±–∏–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å –æ—Ü–µ–Ω–∫—É impact
impact=$(curl -X POST "http://localhost:3011/api/trading/market-impact" \
  -H "Content-Type: application/json" \
  -d '{ ... }')

# 2. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Ä–∞–∑–±–∏–µ–Ω–∏—è
curl -X POST "http://localhost:3011/api/trading/order-splitting" \
  -H "Content-Type: application/json" \
  -d "{
    \"impact\": $impact,
    \"orderSize\": 500000,
    \"volatility\": 0.025
  }"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–ª–∞–Ω –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞ —Å —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º –Ω–∞ chunks –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏.

### 3. –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

```bash
curl -X POST "http://localhost:3011/api/trading/implementation-shortfall" \
  -H "Content-Type: application/json" \
  -d '{
    "decisionPrice": 50000,
    "actualFillPrice": 50150,
    "orderSize": 100000,
    "side": "BUY"
  }'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–Ω–∞–ª–∏–∑ –∏–∑–¥–µ—Ä–∂–µ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è (shortfall = $150 –∏–ª–∏ 30 bps).

## üìä Urgency Levels

| Urgency    | Impact Multiplier | Typical Use Case                             |
| ---------- | ----------------- | -------------------------------------------- |
| **Low**    | 1.0x              | Portfolio rebalancing, long-term positioning |
| **Medium** | 1.5x              | Normal trading, moderate time pressure       |
| **High**   | 2.5x              | Stop-loss, liquidation, urgent exit          |

## üìê Participation Rate

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –û—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –æ—Ä–¥–µ—Ä–∞ –∫ –¥–Ω–µ–≤–Ω–æ–º—É –æ–±—ä–µ–º—É —Ç–æ—Ä–≥–æ–≤

```
Participation Rate = Order Size / Daily Volume
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**

| Rate  | Impact    | Recommendation                                      |
| ----- | --------- | --------------------------------------------------- |
| < 1%  | Low       | Execute immediately                                 |
| 1-5%  | Medium    | Consider splitting (2-5 chunks)                     |
| 5-20% | High      | Split into 5-10 chunks                              |
| > 20% | Very High | Split into 10+ chunks, consider multi-day execution |

## üßÆ Square Root Law

Market impact —Ä–∞—Å—Ç–µ—Ç –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ **–∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–º—É –∫–æ—Ä–Ω—é** –∏–∑ participation rate:

```
Impact ‚àù sqrt(participation_rate)
```

**–ü–æ—á–µ–º—É –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å?**

- –õ–∏–Ω–µ–π–Ω–∞—è –º–æ–¥–µ–ª—å –ø–µ—Ä–µ–æ—Ü–µ–Ω–∏–≤–∞–µ—Ç impact –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ—Ä–¥–µ—Ä–æ–≤
- –≠–º–ø–∏—Ä–∏—á–µ—Å–∫–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç sqrt-relationship
- –û—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –¥–∏–Ω–∞–º–∏–∫—É order book

**–ü—Ä–∏–º–µ—Ä:**

| Order Size | Participation | Impact (linear) | Impact (sqrt) |
| ---------- | ------------- | --------------- | ------------- |
| $10K       | 1%            | 1x              | 1x            |
| $100K      | 10%           | 10x             | 3.16x         |
| $1M        | 100%          | 100x            | 10x           |

## ‚öñÔ∏è Optimal Order Splitting

**Almgren-Chriss Framework:**

–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ chunks:

```
Optimal Chunks ‚âà sqrt(participation_rate √ó 100)
```

–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è:

```
Optimal Time ‚àù sqrt(participation_rate) √ó volatility √ó (1 + risk_aversion)
```

**Trade-off:**

- –ë–æ–ª—å—à–µ chunks = –º–µ–Ω—å—à–µ impact, –Ω–æ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏
- –ú–µ–Ω—å—à–µ chunks = –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –≤—ã—à–µ impact

## üéØ Best Practices

### 1. Pre-Trade Analysis

```bash
# ALWAYS –æ—Ü–µ–Ω–∏–≤–∞–π—Ç–µ impact –ø–µ—Ä–µ–¥ –∫—Ä—É–ø–Ω—ã–º –æ—Ä–¥–µ—Ä–æ–º
if order_size > 0.01 * daily_volume:
    impact = calculate_market_impact(order)
    if impact.recommendation.shouldSplit:
        use_splitting_strategy()
```

### 2. Time Diversification

```
Spread execution across time
- Reduces average impact
- Exploits mean reversion
- Captures better prices
```

### 3. Urgency Management

```
Low urgency ‚Üí Minimize cost
Medium urgency ‚Üí Balance cost/time
High urgency ‚Üí Accept higher cost
```

### 4. Monitoring Implementation Shortfall

```bash
# Track actual vs expected execution
for each fill:
    shortfall = actual_price - decision_price
    cumulative_cost += shortfall √ó fill_size
```

## ‚ö†Ô∏è Limitations

1. **Model Assumptions:**

   - Assumes normal market conditions
   - Doesn't account for extreme events
   - Ignores other large orders

2. **Data Requirements:**

   - Need accurate daily volume
   - Spread can change rapidly
   - Volatility is historical

3. **Market Microstructure:**
   - Order book depth varies
   - Hidden liquidity exists
   - Dark pools not included

## üöÄ Future Improvements

### Planned:

1. **Machine Learning Impact Predictor** ‚Äî ML model trained on execution data
2. **Real-time Order Book Analysis** ‚Äî Dynamic impact based on current liquidity
3. **Cross-Exchange Routing** ‚Äî Split across multiple exchanges
4. **Adaptive Execution** ‚Äî Adjust strategy based on realized impact
5. **Time-of-Day Effects** ‚Äî Account for intraday liquidity patterns
6. **Volume Participation (VWAP/TWAP)** ‚Äî Algorithm-based execution
7. **Smart Order Router** ‚Äî Automatic venue selection

## üìö –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞

1. **Almgren & Chriss (2000)** - "Optimal Execution of Portfolio Transactions"
2. **Kyle (1985)** - "Continuous Auctions and Insider Trading"
3. **Hasbrouck (2009)** - "Trading Costs and Returns for U.S. Equities"
4. **Grinold & Kahn (1999)** - "Active Portfolio Management"

## üîó –°–º. —Ç–∞–∫–∂–µ

- [Portfolio Rebalancing](../../portfolio/PORTFOLIO_REBALANCING.md)
- [Trading Service](../README.md)
- [Aladdin Roadmap](../../../docs/ALADDIN_ROADMAP.md)
